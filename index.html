<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ú–µ–≥–∞ –ë–æ–Ω—É—Å–∫–∞</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<style>
  :root { --cell-h: 60px; --w: 290px; }

  * { box-sizing: border-box; }
  body{
    margin:0; min-height:100vh; display:grid; place-items:center;
    background:#0a0b1a; color:#ffe477; font-family: Inter, system-ui, Arial, sans-serif;
  }
  .wrap{ width: min(92vw, 360px); text-align:center; }
  .title{ font-size:28px; font-weight:800; margin:2px 0 6px; text-shadow:0 2px 12px rgba(255,228,80,.25); }
  .sub{ color:#cfcfd8; opacity:.85; margin-bottom:14px; }

  .reel{
    position:relative; width:var(--w); height:calc(var(--cell-h) * 3);
    margin:12px auto 18px; border-radius:14px; overflow:hidden;
    border:2px solid rgba(255,255,255,.18);
    background: radial-gradient(120% 120% at 50% 0%, #0f1640 0%, #060914 65%);
    box-shadow: 0 10px 30px rgba(0,0,0,.35) inset;
  }
  .track{
    position:absolute; inset:0 auto 0 0; width:100%;
    transition: transform 16s cubic-bezier(.18,.85,.28,1);
    will-change: transform;
  }
  .cell{
    height:var(--cell-h); display:flex; align-items:center; justify-content:center;
    font-weight:800; font-size:20px; letter-spacing:.4px;
    color:#ffe477;
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  .marker{
    pointer-events:none;
    position:absolute; left:0; top:var(--cell-h); width:100%; height:var(--cell-h);
    border-top:2px solid rgba(255,255,255,.22);
    border-bottom:2px solid rgba(255,255,255,.22);
  }
  .arrow{
    position:absolute; right:8px; top:50%; transform:translateY(-50%);
    width:0; height:0;
    border-left:12px solid #3bff7b;
    border-top:8px solid transparent; border-bottom:8px solid transparent;
    filter: drop-shadow(0 0 6px #3bff7b);
  }

  .btn{
    display:inline-block; width:var(--w); padding:14px 18px; border-radius:14px;
    border:0; cursor:pointer; font-weight:900; font-size:18px; color:#fff;
    background: linear-gradient(135deg,#ff2d6f,#fe7a28);
    box-shadow: 0 6px 18px rgba(254, 89, 68, .45);
    margin-top:10px;
  }
  .btn:disabled{ background:#6b6b6b; box-shadow:none; cursor:not-allowed; }

  .result{ margin-top:14px; font-size:18px; display:none; }

  /* –ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç—Å–∫–æ–∫–∞ */
  @keyframes bounceStop {
    0%   { transform: translateY(var(--final-pos)); }
    40%  { transform: translateY(calc(var(--final-pos) + 6px)); }
    70%  { transform: translateY(calc(var(--final-pos) - 3px)); }
    100% { transform: translateY(var(--final-pos)); }
  }
  .bounce {
    animation: bounceStop 0.5s ease-out forwards;
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="title">–ú–µ–≥–∞ –ë–æ–Ω—É—Å–∫–∞</div>
    <div class="sub" id="attempts">–£ –≤–∞—Å –ø–æ–ø—ã—Ç–æ–∫: 1</div>

    <div class="reel" aria-live="polite">
      <div class="track" id="track"></div>
      <div class="marker"><div class="arrow"></div></div>
    </div>

    <button class="btn" id="spin">–ö–†–£–¢–ò–¢–¨</button>
    <div class="result" id="res">–£—Ä–∞! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ 1 USDT üéâ</div>
  </div>

<script>
  const tg = window.Telegram?.WebApp;
  if (tg) { tg.ready(); tg.expand(); }

  const base = [
    "0.1 BTC","1 BTC","10 BTC",
    "100 DOGE","500 USDT","1 USDT","3 ETH",
    "10 ETH","0.1 ETH","100 XRP","5 BNB","2 BNB"
  ];
  const slipFromLabel = "500 USDT";
  const targetLabel   = "1 USDT";
  const cellH = 60, middleIndex = 1;
  const track = document.getElementById('track');
  const spinBtn = document.getElementById('spin');
  const resEl  = document.getElementById('res');
  const attemptsEl = document.getElementById('attempts');

  let long = [];
  for (let i=0;i<30;i++) long = long.concat(base);
  track.innerHTML = long.map(v => `<div class="cell">${v}</div>`).join('');

  let startIndex = Math.floor(base.length/2);
  track.style.transform = `translateY(${-(startIndex)*cellH}px)`;

  let attempts = 1;

  spinBtn.addEventListener('click', () => {
    if (attempts <= 0) return;
    attempts--;
    attemptsEl.textContent = `–£ –≤–∞—Å –ø–æ–ø—ã—Ç–æ–∫: ${attempts}`;
    spinBtn.disabled = true;

    const mainDurationMs = 16000;  // –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
    const pauseBetween   = 0;    // –ø–∞—É–∑–∞ –Ω–∞ "–ø–æ–¥–≤–∏—Å–∞–Ω–∏–∏"
    const slipDuration   = 500;    // —Å–≤–∞–ª–∏–≤–∞–Ω–∏–µ
    const postBounceDelay= 600;

    const slipIndex = base.indexOf(slipFromLabel);
    const extraRounds = 14;
    const slipIndexInLong = extraRounds*base.length + slipIndex;

    // –ø–æ–∑–∏—Ü–∏—è "–º–µ–∂–¥—É" 500 USDT –∏ 1 USDT ‚Üí –¥–æ–±–∞–≤–∏–º –ø–æ–ª–æ–≤–∏–Ω—É –≤—ã—Å–æ—Ç—ã —è—á–µ–π–∫–∏
    const finalY_mid = -((slipIndexInLong - middleIndex) * cellH) - cellH/2;

    // —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è —Ä–æ–≤–Ω–æ –Ω–∞ 1 USDT
    const finalY_target = -( (slipIndexInLong+1 - middleIndex) * cellH );

    // –∑–∞–ø—É—Å–∫–∞–µ–º –¥–ª–∏–Ω–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ –¥–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
    track.style.transition = `transform ${mainDurationMs/1000}s cubic-bezier(.18,.85,.28,1)`;
    track.style.setProperty("--final-pos", finalY_target + "px"); // –¥–ª—è bounce
    requestAnimationFrame(() => {
      track.style.transform = `translateY(${finalY_mid}px)`;
    });

    // –ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∂–¥—ë–º –ø–∞—É–∑—É –∏ –¥–µ–ª–∞–µ–º —Å–≤–∞–ª–∏–≤–∞–Ω–∏–µ
    setTimeout(() => {
      setTimeout(() => {
        track.style.transition = `transform ${slipDuration}ms cubic-bezier(.2,1,.3,1)`;
        requestAnimationFrame(() => {
          track.style.transform = `translateY(${finalY_target}px)`;
        });

        // –ø–æ—Å–ª–µ –ø–∞–¥–µ–Ω–∏—è ‚Äî bounce
        setTimeout(() => {
          track.classList.add("bounce");

          setTimeout(() => {
            resEl.style.display = 'block';
            spinBtn.style.display = "none";

            spinBtn.textContent = "–ó–ê–ë–†–ê–¢–¨";
            spinBtn.disabled = false;
            spinBtn.style.display = "inline-block";

            confetti({
              particleCount: 140,
              spread: 90,
              origin: { y: 0.6 }
            });

            spinBtn.onclick = () => {
              if (tg) {
                tg.sendData(targetLabel);
              } else {
                alert("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –±–æ—Ç–∞: " + targetLabel);
              }
            };

            setTimeout(() => track.classList.remove("bounce"), 800);

          }, postBounceDelay);
        }, slipDuration+20);
      }, pauseBetween);
    }, mainDurationMs+200);
  });
</script>
</body>
</html>

